[
{
	"uri": "/vi/1-preparation/",
	"title": "Chuẩn bị",
	"tags": [],
	"description": "",
	"content": "Trước khi chúng ta đi vào nội dung chính của bài workshop này, chúng ta cần phải reset ứng dụng web.\nTải xuống mã nguồn dưới đây.\nMã nguồn\rfcj-book-store-sam-ws6.zip\r(24397 ko)\rGiải nén mã nguồn, mở template.yaml.\nThay đổi giá trị chaunguyen.site thành tên miền của bạn.\nroute53HostedZoneName: Type: String Default: chaunguyen.site Chạy các lệnh dưới đây. Đảm bảo bạn đã cài đặt AWS CLI và SAM CLI trên máy của bạn, cấu hình thông tin xác thực AWS trước khi chạy các lệnh.\nsam build sam validate sam deploy --guided Nhập nội dung sau. Để mặc định.\nStack Name []: fcj-book-store AWS Region []: us-east-1 Confirm changes before deploy [Y/n]: y Allow SAM CLI IAM role creation [Y/n]: y Disable rollback [y/N]: n Save arguments to configuration file [Y/n]: y Thực hiện theo hướng dẫn này nếu nhà đăng ký tên miền của bạn không phải là AWS. Sử dụng Route 53 làm dịch vụ DNS cho một tên miền đang sử dụng\nSao chép các bản ghi loại NS từ vùng lưu trữ Route53 của bạn. Dán các bản ghi NS đó vào nhà đăng ký tên miền DNS của bạn. Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nBỏ chú thích khối mã này.\n# FcjCertificate: # Type: AWS::CertificateManager::Certificate # Properties: # DomainName: !Sub \u0026#34;*.${route53HostedZoneName}\u0026#34; # SubjectAlternativeNames: # - !Ref route53HostedZoneName # ValidationMethod: DNS # DomainValidationOptions: # - DomainName: !Sub \u0026#34;*.${route53HostedZoneName}\u0026#34; # HostedZoneId: !Ref FcjRoute53HostedZone # FcjCloudFrontDistribution: # Type: AWS::CloudFront::Distribution # Properties: # DistributionConfig: # Enabled: true # Origins: # - DomainName: !GetAtt FcjBookShop.RegionalDomainName # Id: !Ref FcjBookShop # CustomOriginConfig: # HTTPPort: 80 # HTTPSPort: 443 # OriginProtocolPolicy: match-viewer # OriginSSLProtocols: # - TLSv1 # - TLSv1.1 # - TLSv1.2 # Aliases: # - !Sub \u0026#34;www.${route53HostedZoneName}\u0026#34; # - !Ref route53HostedZoneName # DefaultCacheBehavior: # CachePolicyId: !Ref cachePolicyId # ViewerProtocolPolicy: redirect-to-https # TargetOriginId: !Ref FcjBookShop # AllowedMethods: # - GET # - HEAD # DefaultRootObject: index.html # ViewerCertificate: # AcmCertificateArn: !Ref FcjCertificate # SslSupportMethod: sni-only # FcjRoute53RecordSet: # Type: AWS::Route53::RecordSet # Properties: # HostedZoneId: !Ref FcjRoute53HostedZone # Name: !Sub \u0026#34;www.${route53HostedZoneName}.\u0026#34; # Type: A # AliasTarget: # DNSName: !GetAtt FcjCloudFrontDistribution.DomainName # HostedZoneId: !Ref cloudFrontHostedZoneId Chạy các lệnh dưới đây.\nViệc triển khai Cloudfront Distribution có thể mất một lúc để hoàn thành, vì vậy hãy kiên nhẫn chờ đợi.\nsam build sam validate sam deploy Tải mã nguồn FCJ-Serverless-Workshop về thiết bị của bạn.\nMở terminal trên máy tính của bạn trong thư mục nơi bạn muốn lưu mã nguồn.\nSao chép lệnh dưới đây.\ngit clone https://github.com/AWS-First-Cloud-Journey/FCJ-Serverless-Workshop.git cd FCJ-Serverless-Workshop Mở FCJ-Serverless-Workshop với VSCode và chỉnh sửa.\nMở src/App.js và chỉnh sửa isAdmin: true như dưới đây. Quay lại thư mục gốc của FCJ-Serverless-Workshop và chạy các lệnh dưới đây.\nyarn yarn build Chúng ta đã hoàn thành việc xây dựng front-end. Tiếp theo, thực hiện lệnh sau để tải thư mục build lên S3.\naws s3 cp build s3://fcj-book-shop-by-myself --recursive Nhập các liên kết sau vào một tab mới trong trình duyệt web của bạn: http://www.DOMAIN, thay thế tất cả DOMAIN bằng tên miền của bạn. Tất cả các liên kết đó sẽ chuyển hướng đến đường dẫn mới, thay thế http bằng https. Vậy là chúng ta đã xây dựng lại ứng dụng web.\n"
},
{
	"uri": "/vi/",
	"title": "Serverless - Xử lý đơn hàng với SQS-SNS",
	"tags": [],
	"description": "",
	"content": "Serverless - Xử lý đơn hàng với SQS-SNS Tổng quan Trong bài số 6 của series này, chúng ta sẽ xử lý các đơn đặt hàng của người dùng sử dụng Amazon SQS và SNS. Khi người dùng đặt hàng, đơn hàng sẽ được đẩy vào hàng đợi và SNS sẽ thông báo cho admin về đơn hàng mới đó. Admin có quyền xem tất cả các đơn đặt hàng và xử lý hoặc xoá chúng.\nKiến trúc của ứng dụng web sẽ như sau: Khi người dùng đặt hàng (ấn Checkout), API POST /books/order đưa thông tin của đơn hàng vào hàng đợi mà bạn tạo, sau đó pulish một tin nhắn qua Amazon SNS topic API GET /books/order được gọi khi admin sử dụng tính năng quản lý đơn hàng để lấy toàn bộ đơn hàng chưa xử lý trong hàng đợi và đã xử lý trong bảng của DynamoDB Khi Admin xử lý đơn hàng (ấn Handle), API POST /books/order/handle sẽ đẩy đơn hàng vào DynamoDB và xoá nó trong hàng đợi Khi Admin xoá đơn hàng (ấn Delete), API DELETE /books/order sẽ xoá đơn hàng khỏi hàng đợi Amazon Simple Queue Service Amazon Simple Queue Service cung cấp một hàng đợi an toàn, bền vững và có sẵn cho phép bạn tích hợp và tách rời các hệ thống và thành phần phần mềm phân tán. Nó có thể mở rộng quy mô độc lập với ứng dụng của chúng ta. Nó cung cấp một API dịch vụ web chung mà bạn có thể truy cập bằng bất kỳ ngôn ngữ lập trình nào mà AWS SDK hỗ trợ. Amazon SQS hỗ trợ cả hàng đợi tiêu chuẩn và FIFO.\nMột hệ thống message phân tán gồm 3 phần chính: các thành phần của hệ thống phân tán, hàng đợi của bạn (được phân phối trên máy chủ Amazon SQS) và các tin nhắn trong hàng đợi. Ví dụ: hệ thống của bạn có một số nhà sản xuất (thành phần gửi thông điệp đến hàng đợi) và người tiêu dùng (thành phần nhận thông báo từ hàng đợi). Hàng đợi (chứa các thông báo) lưu trữ các thông báo trên máy chủ Amazon SQS.\nAmazon Simple Notification Service Amazon Simple Notification Service (SNS) một dịch vụ được quản lý để cung cấp dịch vụ gửi tin nhắn từ publishers đến subscribers (còn được gọi là producers và consumers). Publishers giao tiếp không đồng bộ với subscribers bằng cách gửi tin nhắn đến một topic, đây là điểm truy cập và kênh giao tiếp logic. Khách hàng có thể đăng ký SNS topic và nhận các tin nhắn đã xuất bản bằng cách sử dụng loại điểm cuối được hỗ trợ, chẳng hạn như Amazon Kinesis Data Firehose, Amazon SQS, AWS Lambda, HTTP, email, thông báo đẩy trên thiết bị di động và tin nhắn văn bản di động (SMS).\nNội dung Chuẩn bị Tạo hàng đợi và SNS topic Tạo API và Lambda function Kiểm tra hoạt động Dọn dẹp tài nguyên "
},
{
	"uri": "/vi/3-create-api-lambda-function/3-1-create-orders-table-dynamodb-table/",
	"title": "Tạo bảng OrdersTable DynamoDB",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ tạo một bảng DynamoDB mới bằng cách sử dụng mẫu SAM.\nTạo bảng FcjOrdersTable DynamoDB Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nThêm các đoạn mã sau đây để tạo bảng FcjOrdersTable.\norderTable: Type: String Default: OrdersTable FcjOrdersTable: Type: AWS::DynamoDB::Table Properties: TableName: !Ref orderTable BillingMode: PAY_PER_REQUEST AttributeDefinitions: - AttributeName: id AttributeType: S - AttributeName: book_id AttributeType: S KeySchema: - AttributeName: id KeyType: HASH - AttributeName: book_id KeyType: RANGE Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Mở AWS DynamoDB console để kiểm tra. "
},
{
	"uri": "/vi/2-create-sqs-and-sns/2-1-create-sqs/",
	"title": "Tạo hàng đợi",
	"tags": [],
	"description": "",
	"content": " Mở Amazon SQS console.\nNhấp vào Queues trên menu bên trái. Nhấp vào Create queue. Tại trang Create queue.\nChọn loại Standard. Nhập tên checkout-queue. Để mặc định, cuộn xuống và nhấp vào nút Create queue. Tại trang checkout-queue.\nNhấp vào nút Send and receive messages. Tại trang Send and receive messages.\nNhập The first message tại Message body. Nhấp vào Send message để gửi tin nhắn đến hàng đợi. Nhấp vào Poll for messages để nhận tất cả tin nhắn gửi đến hàng đợi. Nhấp vào tin nhắn vừa được hiển thị. Tại cửa sổ Message: \u0026hellip;, kiểm tra tin nhắn Body và nhấp vào nút Done. Nhấp vào hộp kiểm của tin nhắn vừa được hiển thị. Nhấp vào nút Delete. Tại cửa sổ Delete Messages, nhấp vào nút Delete. "
},
{
	"uri": "/vi/2-create-sqs-and-sns/2-2-create-sns/",
	"title": "Tạo chủ đề SNS",
	"tags": [],
	"description": "",
	"content": " Mở Amazon SNS console\nNhấp vào Topics trên menu bên trái. Nhấp vào nút Create topic. Tại trang Create topic.\nNhấp vào Standard tại Type. Nhập order-notice tại Name. Để mặc định, cuộn xuống và nhấp vào nút Create topic. Tại trang order-notice.\nNhấp vào tab Subscriptions. Nhấp vào nút Create subscription. Tại trang Create subscription.\nChọn Email tại Protocol. Nhập email của bạn tại Endpoint. Nhấp vào Create subscription. Quay lại trang order-notice.\nNhấp vào tab Subscriptions. Kiểm tra đăng ký vừa được tạo với trạng thái Pending confirmation. Mở hộp thư email của bạn, tìm email gửi từ no-reply@sns.amazonaws.com.\nNhấp vào liên kết Confirm subscription. Nó sẽ chuyển hướng bạn đến một tab mới. Quay lại trang order-notice, kiểm tra trạng thái Confirmed của đăng ký bạn vừa tạo. "
},
{
	"uri": "/vi/3-create-api-lambda-function/3-2-create-checkout-order-lambda-function/",
	"title": "Tạo hàm checkout_order Lambda",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ tạo một hàm checkout_order Lambda mới bằng cách sử dụng mẫu SAM.\nChuẩn bị Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nBình luận khối mã này.\n# BookApiDeployment: # Type: AWS::ApiGateway::Deployment # Properties: # RestApiId: !Ref BookApi # DependsOn: # - BookApiGet # - BookApiCreate # - BookApiDelete # - LoginApi # - RegisterApi # - ConfirmApi BookApiStage: Type: AWS::ApiGateway::Stage Properties: RestApiId: !Ref BookApi StageName: !Ref stage # DeploymentId: !Ref BookApiDeployment Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Tạo hàm FcjCheckOutOrder Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nThêm các đoạn mã sau đây để tạo hàm FcjCheckOutOrder. Thay đổi giá trị checkoutQueueUrl và orderTopicArn thành giá trị của bạn.\ncheckoutQueueName: Type: String Default: checkout-queue checkoutQueueUrl: Type: String Default: https://sqs.us-east-1.amazonaws.com/017820706022/checkout-queue orderTopicName: Type: String Default: order-notice orderTopicArn: Type: String Default: arn:aws:sns:us-east-1:017820706022:order-notice checkoutPathPart: Type: String Default: order FcjCheckOutOrderFunction: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-shop/checkout_order Handler: checkout_order.lambda_handler Runtime: python3.11 FunctionName: checkout_order Environment: Variables: SQS_QUEUE_URL: !Ref checkoutQueueUrl SNS_TOPIC_ARN: !Ref orderTopicArn Architectures: - x86_64 Policies: - Statement: - Sid: VisualEditor0 Effect: Allow Action: - sqs:* Resource: - !Sub \u0026#34;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:${checkoutQueueName}\u0026#34; - Sid: VisualEditor1 Effect: Allow Action: - sns:Publish Resource: - !Sub \u0026#34;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${orderTopicName}\u0026#34; FcjCheckoutOrderResource: Type: AWS::ApiGateway::Resource Properties: RestApiId: !Ref BookApi ParentId: !Ref BookApiResource PathPart: !Ref checkoutPathPart FcjCheckoutOrderApiOptions: Type: AWS::ApiGateway::Method Properties: HttpMethod: OPTIONS RestApiId: !Ref BookApi ResourceId: !Ref FcjCheckoutOrderResource AuthorizationType: NONE Integration: Type: MOCK RequestTemplates: application/json: \u0026#39;{\u0026#34;statusCode\u0026#34;: 200}\u0026#39; IntegrationResponses: - StatusCode: \u0026#34;200\u0026#34; ResponseParameters: method.response.header.Access-Control-Allow-Origin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; method.response.header.Access-Control-Allow-Methods: \u0026#34;\u0026#39;OPTIONS,POST,GET,DELETE\u0026#39;\u0026#34; method.response.header.Access-Control-Allow-Headers: \u0026#34;\u0026#39;Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token\u0026#39;\u0026#34; MethodResponses: - StatusCode: \u0026#34;200\u0026#34; ResponseParameters: method.response.header.Access-Control-Allow-Origin: true method.response.header.Access-Control-Allow-Methods: true method.response.header.Access-Control-Allow-Headers: true FcjCheckoutOrderApi: Type: AWS::ApiGateway::Method Properties: HttpMethod: POST RestApiId: !Ref BookApi ResourceId: !Ref FcjCheckoutOrderResource AuthorizationType: NONE Integration: Type: AWS_PROXY IntegrationHttpMethod: POST # For Lambda integrations, you must set the integration method to POST Uri: !Sub \u0026gt;- arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FcjCheckOutOrderFunction.Arn}/invocations MethodResponses: - StatusCode: \u0026#34;200\u0026#34; ResponseParameters: method.response.header.Access-Control-Allow-Origin: true method.response.header.Access-Control-Allow-Methods: true method.response.header.Access-Control-Allow-Headers: true FcjCheckoutOrderApiInvokePermission: Type: AWS::Lambda::Permission Properties: FunctionName: !Ref FcjCheckOutOrderFunction Action: lambda:InvokeFunction Principal: apigateway.amazonaws.com SourceAccount: !Ref \u0026#34;AWS::AccountId\u0026#34; Cấu trúc thư mục như sau.\nfcj-book-shop-sam-ws3 ├── fcj-book-shop │ ├── checkout_order │ │ └── checkout_order.py │ ├── ... │ └── template.yaml Tạo thư mục checkout_order trong thư mục fcj-book-shop-sam-ws6/fcj-book-shop/.\nTạo tệp checkout_order.py và sao chép mã sau vào đó.\nimport json import boto3 import os headers = { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Access-Control-Allow-Methods\u0026#34;: \u0026#34;OPTIONS,POST,GET,DELETE\u0026#34;, \u0026#34;Access-Control-Allow-Headers\u0026#34;: \u0026#34;Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token\u0026#34; } def lambda_handler(event, context): sqs = boto3.client(\u0026#39;sqs\u0026#39;) sns = boto3.client(\u0026#39;sns\u0026#39;) sqs_queue_url = os.environ[\u0026#39;SQS_QUEUE_URL\u0026#39;] sns_topic_arn = os.environ[\u0026#39;SNS_TOPIC_ARN\u0026#39;] sns_topic_subject = \u0026#34;New order received. Please process.\u0026#34; try: body = json.loads(event[\u0026#39;body\u0026#39;]) print(f\u0026#34;body: {body}\u0026#34;) # Send to SQS sqs_response = sqs.send_message( QueueUrl=sqs_queue_url, MessageBody=json.dumps(body) ) # Send to SNS sns_response = sns.publish( TopicArn=sns_topic_arn, Message=f\u0026#34;New order received: {json.dumps(body)}\u0026#34;, Subject=sns_topic_subject ) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;headers\u0026#39;: headers, \u0026#39;body\u0026#39;: json.dumps({ \u0026#39;message\u0026#39;: \u0026#39;Order processed successfully\u0026#39;, \u0026#39;sqs_message_id\u0026#39;: sqs_response[\u0026#39;MessageId\u0026#39;], \u0026#39;sns_message_id\u0026#39;: sns_response[\u0026#39;MessageId\u0026#39;] }) } except Exception as e: print(f\u0026#34;Error processing order: {e}\u0026#34;) raise Exception(f\u0026#34;Error processing order: {e}\u0026#34;) Bỏ bình luận khối mã này.\nBookApiDeployment: Type: AWS::ApiGateway::Deployment Properties: RestApiId: !Ref BookApi DependsOn: - BookApiGet - BookApiCreate - BookApiDelete - LoginApi - RegisterApi - ConfirmApi - FcjCheckoutOrderApi BookApiStage: Type: AWS::ApiGateway::Stage Properties: RestApiId: !Ref BookApi StageName: !Ref stage DeploymentId: !Ref BookApiDeployment Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Kiểm tra việc tạo Mở Amazon API Gateway console.\nNhấp vào fcj-serverless-api. Nhấp vào Resources trên menu bên trái. Kiểm tra /order vừa được tạo. Mở Amazon Lambda console.\nNhấp vào Functions trên menu bên trái. Chọn hàm checkout_order. Tại trang checkout_order, kiểm tra hàm vừa được tạo. "
},
{
	"uri": "/vi/2-create-sqs-and-sns/",
	"title": "Tạo hàng đợi và chủ đề SNS",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ tạo một hàng đợi với Amazon SQS và một chủ đề SNS với Amazon SNS.\nTạo SQS Tạo chủ đề SNS "
},
{
	"uri": "/vi/3-create-api-lambda-function/",
	"title": "Tạo API và hàm Lambda",
	"tags": [],
	"description": "",
	"content": "Sau khi tạo hàng đợi và chủ đề SQS, chúng ta sẽ tạo các API và hàm Lambda để tương tác với hàng đợi và chủ đề SQS.\nTạo bảng OrdersTable DynamoDB Tạo hàm checkout_order Lambda Tạo hàm order_management Lambda Tạo hàm handle_order Lambda Tạo hàm delete_order Lambda "
},
{
	"uri": "/vi/3-create-api-lambda-function/3-3-create-order-management-lambda-function/",
	"title": "Tạo hàm order_management Lambda",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ tạo một hàm order_management Lambda mới bằng cách sử dụng mẫu SAM.\nChuẩn bị Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nBình luận khối mã này.\n# BookApiDeployment: # Type: AWS::ApiGateway::Deployment # Properties: # RestApiId: !Ref BookApi # DependsOn: # - BookApiGet # - BookApiCreate # - BookApiDelete # - LoginApi # - RegisterApi # - ConfirmApi BookApiStage: Type: AWS::ApiGateway::Stage Properties: RestApiId: !Ref BookApi StageName: !Ref stage # DeploymentId: !Ref BookApiDeployment Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Tạo hàm FcjOrderManagement Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nThêm các đoạn mã sau để tạo hàm FcjOrderManagement.\nFcjOrderManagementFunction: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-shop/order_management Handler: order_management.lambda_handler Runtime: python3.11 FunctionName: order_management Environment: Variables: SQS_QUEUE_URL: !Ref checkoutQueueUrl ORDER_TABLE_NAME: !Ref orderTable Architectures: - x86_64 Policies: - Statement: - Sid: VisualEditor0 Effect: Allow Action: - dynamodb:Scan - dynamodb:Query Resource: - !Sub \u0026#34;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${orderTable}\u0026#34; - Sid: VisualEditor1 Effect: Allow Action: - sqs:* Resource: - !Sub \u0026#34;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:${checkoutQueueName}\u0026#34; FcjOrderManagementApi: Type: AWS::ApiGateway::Method Properties: HttpMethod: GET RestApiId: !Ref BookApi ResourceId: !Ref FcjCheckoutOrderResource AuthorizationType: NONE Integration: Type: AWS_PROXY IntegrationHttpMethod: POST # For Lambda integrations, you must set the integration method to POST Uri: !Sub \u0026gt;- arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FcjOrderManagementFunction.Arn}/invocations MethodResponses: - StatusCode: \u0026#34;200\u0026#34; ResponseParameters: method.response.header.Access-Control-Allow-Origin: true method.response.header.Access-Control-Allow-Methods: true method.response.header.Access-Control-Allow-Headers: true FcjOrderManagementApiInvokePermission: Type: AWS::Lambda::Permission Properties: FunctionName: !Ref FcjOrderManagementFunction Action: lambda:InvokeFunction Principal: apigateway.amazonaws.com SourceAccount: !Ref \u0026#34;AWS::AccountId\u0026#34; Cấu trúc thư mục như sau.\nfcj-book-shop-sam-ws3 ├── fcj-book-shop │ ├── checkout_order │ │ └── checkout_order.py │ ├── order_management │ │ └── order_management.py │ ├── ... │ └── template.yaml Tạo thư mục order_management trong thư mục fcj-book-shop-sam-ws6/fcj-book-shop/.\nTạo tệp order_management.py và sao chép mã sau vào đó.\nimport os import json import boto3 headers = { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Access-Control-Allow-Methods\u0026#34;: \u0026#34;OPTIONS,POST,GET,DELETE\u0026#34;, \u0026#34;Access-Control-Allow-Headers\u0026#34;: \u0026#34;Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token\u0026#34; } dynamodb = boto3.resource(\u0026#39;dynamodb\u0026#39;) sqs = boto3.client(\u0026#39;sqs\u0026#39;) # Get value of the environment variables table_name = os.getenv(\u0026#39;ORDER_TABLE_NAME\u0026#39;) queue_url = os.getenv(\u0026#39;SQS_QUEUE_URL\u0026#39;) def get_messages_from_sqs(messages): # Get the total number of messages in the queue response = sqs.get_queue_attributes( QueueUrl=queue_url, AttributeNames=[\u0026#39;ApproximateNumberOfMessages\u0026#39;] ) total_messages = int(response[\u0026#39;Attributes\u0026#39;][\u0026#39;ApproximateNumberOfMessages\u0026#39;]) while len(messages) \u0026lt; total_messages: # Receive messages from SQS queue received_message_res = sqs.receive_message( QueueUrl=queue_url, MaxNumberOfMessages=10, WaitTimeSeconds=20 ) if \u0026#39;Messages\u0026#39; in received_message_res: for message in received_message_res[\u0026#39;Messages\u0026#39;]: messages.append({ \u0026#34;receiptHandle\u0026#34;: message[\u0026#34;ReceiptHandle\u0026#34;], \u0026#34;books\u0026#34;: json.loads(message[\u0026#34;Body\u0026#34;])[\u0026#39;books\u0026#39;], \u0026#34;price\u0026#34;: json.loads(message[\u0026#34;Body\u0026#34;])[\u0026#39;price\u0026#39;], \u0026#34;status\u0026#34;: \u0026#34;Unprocessed\u0026#34; }) def get_messages_from_dynamodb(messages): table = dynamodb.Table(table_name) try: res = table.scan() orders = res.get(\u0026#39;Items\u0026#39;, []) aggregated_orders = {} for order in orders: order_id = order[\u0026#39;id\u0026#39;] book = { \u0026#39;id\u0026#39;: order[\u0026#39;book_id\u0026#39;], \u0026#39;name\u0026#39;: order[\u0026#39;name\u0026#39;], \u0026#39;qty\u0026#39;: order[\u0026#39;qty\u0026#39;], } if order_id not in aggregated_orders: aggregated_orders[order_id] = { \u0026#39;id\u0026#39;: order_id, \u0026#39;books\u0026#39;: [book], \u0026#39;price\u0026#39;: order[\u0026#39;price\u0026#39;] } else: aggregated_orders[order_id][\u0026#39;books\u0026#39;].append(book) for order in aggregated_orders.values(): messages.append({ \u0026#34;receiptHandle\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;books\u0026#34;: order[\u0026#39;books\u0026#39;], \u0026#34;price\u0026#34;: order[\u0026#39;price\u0026#39;], \u0026#34;status\u0026#34;: \u0026#34;Processed\u0026#34; }) except Exception as e: print(f\u0026#34;Error reading from DynamoDB: {e}\u0026#34;) raise Exception(f\u0026#34;Error reading from DynamoDB: {e}\u0026#34;) def lambda_handler(event, context): messages = [] # Get messages from sqs get_messages_from_sqs(messages) # Get Messages from DynamoDB get_messages_from_dynamodb(messages) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps(messages), \u0026#39;headers\u0026#39;: headers } Bỏ bình luận khối mã này.\nBookApiDeployment: Type: AWS::ApiGateway::Deployment Properties: RestApiId: !Ref BookApi DependsOn: - BookApiGet - BookApiCreate - BookApiDelete - LoginApi - RegisterApi - ConfirmApi - FcjCheckoutOrderApi - FcjOrderManagementApi BookApiStage: Type: AWS::ApiGateway::Stage Properties: RestApiId: !Ref BookApi StageName: !Ref stage DeploymentId: !Ref BookApiDeployment Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Kiểm tra việc tạo Mở Amazon API Gateway console.\nNhấp vào fcj-serverless-api. Nhấp vào Resources trên menu bên trái. Kiểm tra /order vừa được tạo. Mở Amazon Lambda console.\nNhấp vào Functions trên menu bên trái. Chọn hàm order_management. Tại trang order_management, kiểm tra hàm vừa được tạo. "
},
{
	"uri": "/vi/4-test-operation/",
	"title": "Kiểm tra hoạt động web",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ kiểm tra hoạt động web.\nMở API Gateway console.\nNhấp vào APIs trên menu bên trái. Chọn fcj-serverless-api. Nhấp vào Stages trên menu bên trái. Chọn Staging. Ghi lại Invoke URL. Mở tệp config.js trong thư mục mã nguồn của ứng dụng - FCJ-Serverless-Workshop.\nThay thế APP_API_URL bằng InvokeURL. Mở terminal của bạn và chạy các lệnh dưới đây.\nyarn build aws s3 rm s3://fcj-book-shop-by-myself --recursive aws s3 cp build s3://fcj-book-shop-by-myself --recursive Bạn có thể tải xuống các tệp hình ảnh tại đây để thêm dữ liệu kiểm tra hoạt động của các dịch vụ. Images\rJava.jpg\r(23 ko)\rLetGoBook.png\r(292 ko)\rNhập các liên kết sau vào một tab mới trong trình duyệt web của bạn: http://www.DOMAIN, thay thế tất cả DOMAIN bằng tên miền của bạn. Tất cả các liên kết này sẽ chuyển hướng đến đường dẫn mới, thay thế http bằng https. Nhấp vào Create new book.\nNhập ID: 1. Nhập tên sách: Java. Nhập tác giả: Jame Patterson. Nhập thể loại: IT. Nhập giá: 10.98. Nhập mô tả: Hướng dẫn cơ bản để học Java. Nhấp vào nút Choose File và chọn hình ảnh LetGoBook.png mà bạn vừa tải xuống. Nhấp vào nút Create. Nhấp vào nút OK khi popup mở ra. Tạo sách mới như bước trước.\nNhấp vào Create new book. Nhập ID: 2. Nhập tên sách: Let's Go. Nhập tác giả: Alex Edwards. Nhập thể loại: IT. Nhập giá: 15.8. Nhập mô tả: Hướng dẫn từng bước để tạo web nhanh, an toàn với Go. Nhấp vào nút Choose File và chọn hình ảnh LetGoBook.png mà bạn vừa tải xuống. Nhấp vào nút Create. Nhấp vào nút OK khi popup mở ra. Quay lại trang chủ.\nNhấp vào Home. Nhấp vào nút Add to cart để thêm cả 2 sách vào giỏ hàng. Sau đó, nhấp vào biểu tượng Cart ở góc trên bên phải. Tại trang Cart Items.\nNhấp vào nút Checkout. Sau đó, nhấp vào nút OK. Mở Amazon SQS console.\nNhấp vào Queues trên menu bên trái. Nhấp vào hàng đợi checkout-queue. Tại trang checkout-queue, nhấp vào nút Send and receive messages. Tại trang Send and receive messages, nhấp vào nút Poll for messages. Sau đó, nhấp vào tin nhắn hiển thị. Kiểm tra popup Message: \u0026hellip; và nhấp vào nút Done. Mở email mà bạn đã đăng ký để nhận thông báo. Quay lại tab ứng dụng.\nNhấp vào Orders và kiểm tra các sách bạn đã thêm vào giỏ hàng. Tiếp theo, lặp lại bước 5 để thêm một số đơn hàng khác theo ý bạn.\nMở tab ứng dụng.\nNhấp vào Orders và kiểm tra các sách bạn đã thêm vào giỏ hàng. Nhấp vào nút Handle và sau đó nhấp vào nút OK trên popup. Mở AWS DynamoDB.\nNhấp vào Tables trên menu bên trái. Chọn bảng OrdersTable. Tại trang OrdersTable, nhấp vào nút Explore table items. Bạn có thể thấy hai cuốn sách trong đơn hàng mà bạn đã nhấp vào nút Handle trước đó. Quay lại tab ứng dụng.\nNhấp vào Orders và kiểm tra các sách bạn đã thêm vào giỏ hàng. Tiếp theo, nhấp vào nút Delete và sau đó nhấp vào nút OK trên popup. Các mục đã xóa sẽ không còn hiển thị nữa. "
},
{
	"uri": "/vi/3-create-api-lambda-function/3-4-create-handle-order-lambda-function/",
	"title": "Tạo hàm handle_order Lambda",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ tạo một hàm handle_order Lambda mới bằng cách sử dụng mẫu SAM.\nChuẩn bị Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nBình luận khối mã này.\n# BookApiDeployment: # Type: AWS::ApiGateway::Deployment # Properties: # RestApiId: !Ref BookApi # DependsOn: # - BookApiGet # - BookApiCreate # - BookApiDelete # - LoginApi # - RegisterApi # - ConfirmApi # - FcjCheckoutOrderApi # - FcjOrderManagementApi # BookApiStage: # Type: AWS::ApiGateway::Stage # Properties: # RestApiId: !Ref BookApi # StageName: !Ref stage # DeploymentId: !Ref BookApiDeployment Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Tạo hàm FcjHandleOrder Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nThêm các đoạn mã sau để tạo hàm FcjHandleOrder.\nhandleOrderPathPart: Type: String Default: handle FcjHandleOrderResource: Type: AWS::ApiGateway::Resource Properties: RestApiId: !Ref BookApi ParentId: !Ref FcjCheckoutOrderResource PathPart: !Ref handleOrderPathPart FcjHandleOrderFunction: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-shop/handle_order Handler: handle_order.lambda_handler Runtime: python3.11 FunctionName: handle_order Environment: Variables: ORDER_TABLE_NAME: !Ref orderTable SQS_QUEUE_URL: !Ref checkoutQueueUrl Architectures: - x86_64 Policies: - Statement: - Sid: VisualEditor0 Effect: Allow Action: - dynamodb:PutItem - dynamodb:BatchWriteItem Resource: - !Sub \u0026#34;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${orderTable}\u0026#34; - Sid: VisualEditor1 Effect: Allow Action: - sqs:* Resource: - !Sub \u0026#34;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:${checkoutQueueName}\u0026#34; FcjHandleOrderApiOptions: Type: AWS::ApiGateway::Method Properties: HttpMethod: OPTIONS RestApiId: !Ref BookApi ResourceId: !Ref FcjHandleOrderResource AuthorizationType: NONE Integration: Type: MOCK IntegrationResponses: - StatusCode: \u0026#34;200\u0026#34; ResponseParameters: method.response.header.Access-Control-Allow-Origin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; method.response.header.Access-Control-Allow-Methods: \u0026#34;\u0026#39;OPTIONS,POST,GET,DELETE\u0026#39;\u0026#34; method.response.header.Access-Control-Allow-Headers: \u0026#34;\u0026#39;Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token\u0026#39;\u0026#34; MethodResponses: - StatusCode: \u0026#34;200\u0026#34; ResponseParameters: method.response.header.Access-Control-Allow-Origin: true method.response.header.Access-Control-Allow-Methods: true method.response.header.Access-Control-Allow-Headers: true FcjHandleOrderApi: Type: AWS::ApiGateway::Method Properties: HttpMethod: POST RestApiId: !Ref BookApi ResourceId: !Ref FcjHandleOrderResource AuthorizationType: NONE Integration: Type: AWS_PROXY IntegrationHttpMethod: POST # For Lambda integrations, you must set the integration method to POST Uri: !Sub \u0026gt;- arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FcjHandleOrderFunction.Arn}/invocations MethodResponses: - StatusCode: \u0026#34;200\u0026#34; ResponseParameters: method.response.header.Access-Control-Allow-Origin: true method.response.header.Access-Control-Allow-Methods: true method.response.header.Access-Control-Allow-Headers: true FcjHandleOrderApiInvokePermission: Type: AWS::Lambda::Permission Properties: FunctionName: !Ref FcjHandleOrderFunction Action: lambda:InvokeFunction Principal: apigateway.amazonaws.com SourceAccount: !Ref \u0026#34;AWS::AccountId\u0026#34; Cấu trúc thư mục như sau.\nfcj-book-shop-sam-ws3 ├── fcj-book-shop │ ├── checkout_order │ │ └── checkout_order.py │ ├── order_management │ │ └── order_management.py │ ├── handle_order │ │ └── handle_order.py │ ├── ... │ └── template.yaml Tạo thư mục handle_order trong thư mục fcj-book-shop-sam-ws6/fcj-book-shop/.\nTạo tệp handle_order.py và sao chép mã sau vào đó.\nimport json import boto3 import os headers = { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Access-Control-Allow-Methods\u0026#34;: \u0026#34;OPTIONS,POST,GET,DELETE\u0026#34;, \u0026#34;Access-Control-Allow-Headers\u0026#34;: \u0026#34;Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token\u0026#34; } dynamodb = boto3.resource(\u0026#39;dynamodb\u0026#39;) sqs = boto3.client(\u0026#39;sqs\u0026#39;) # Define the DynamoDB table name and SQS queue URL table_name = os.getenv(\u0026#39;ORDER_TABLE_NAME\u0026#39;) queue_url = os.getenv(\u0026#39;SQS_QUEUE_URL\u0026#39;) def lambda_handler(event, context): # Get product body info from the event products = json.loads(event[\u0026#39;body\u0026#39;]) books = products[\u0026#39;books\u0026#39;] receipt_handle = products[\u0026#39;receiptHandle\u0026#39;] # Write product info to DynamoDB table = dynamodb.Table(table_name) try: for book in books: data = { \u0026#39;id\u0026#39;: products[\u0026#39;id\u0026#39;], \u0026#39;book_id\u0026#39;: book[\u0026#39;id\u0026#39;], \u0026#39;name\u0026#39;: book[\u0026#39;name\u0026#39;], \u0026#39;qty\u0026#39;: book[\u0026#39;qty\u0026#39;], \u0026#39;price\u0026#39;: str(products[\u0026#39;price\u0026#39;]) } table.put_item(Item=data) except Exception as e: print(f\u0026#34;Error writing to DynamoDB: {e}\u0026#34;) raise Exception(f\u0026#34;Error writing to DynamoDB: {e}\u0026#34;) # Delete message in SQS try: sqs.delete_message( QueueUrl=queue_url, ReceiptHandle=receipt_handle ) except Exception as e: print(f\u0026#34;Error deleting message from SQS: {e}\u0026#34;) raise Exception(f\u0026#34;Error deleting message from SQS: {e}\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;headers\u0026#39;: headers, \u0026#39;body\u0026#39;: json.dumps(\u0026#39;Order processed successfully\u0026#39;) } Bỏ bình luận khối mã này.\nBookApiDeployment: Type: AWS::ApiGateway::Deployment Properties: RestApiId: !Ref BookApi DependsOn: - BookApiGet - BookApiCreate - BookApiDelete - LoginApi - RegisterApi - ConfirmApi - FcjCheckoutOrderApi - FcjOrderManagementApi - FcjHandleOrderApi BookApiStage: Type: AWS::ApiGateway::Stage Properties: RestApiId: !Ref BookApi StageName: !Ref stage DeploymentId: !Ref BookApiDeployment Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Kiểm tra việc tạo Mở Amazon API Gateway console.\nNhấp vào fcj-serverless-api. Nhấp vào Resources trên menu bên trái. Kiểm tra /handle vừa được tạo. Mở Amazon Lambda console.\nNhấp vào Functions trên menu bên trái. Chọn hàm handle_order. Tại trang handle_order, kiểm tra hàm vừa được tạo. "
},
{
	"uri": "/vi/5-cleanup/",
	"title": "Dọn dẹp",
	"tags": [],
	"description": "",
	"content": "\rViệc dọn dẹp sẽ mất một chút thời gian để hoàn thành\nDọn dẹp Route 53\nMở AWS Route 53 console. Nhấp vào Hosted zones trên menu bên trái. Chọn Hosted zones của bạn và dọn dẹp tất cả các bản ghi nếu có thể. Làm trống S3 bucket.\nMở AWS S3 console. Chọn fcj-book-shop-by-myself. Nhấp vào Empty. Nhập permanently delete. Nhấp vào Empty. Làm tương tự cho các bucket bắt đầu với aws-sam-cli-managed-default- và book-image-resize-shop-by-myself. Xóa CloudFormation stacks.\nThực hiện lệnh dưới đây để xóa ứng dụng AWS SAM.\nsam delete --stack-name fcj-book-store sam delete --stack-name aws-sam-cli-managed-default Nếu bạn gặp vấn đề khi xóa bằng lệnh. Mở AWS Cloudformation console. Sau đó, xóa tất cả các stack liên quan đến workshop này.\nDọn dẹp SQS.\nMở Amazon SQS console. Chọn checkout-queue. Nhấp vào Delete. Nhập confirm. Nhấp vào Delete. Dọn dẹp SNS.\nMở Amazon SNS console. Chọn order-notice tại Topics. Nhấp vào Delete. Nhập delete me. Nhấp vào Delete. "
},
{
	"uri": "/vi/3-create-api-lambda-function/3-5-create-delete-order-lambda-function/",
	"title": "Tạo hàm delete_order Lambda",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ tạo một hàm delete_order Lambda mới bằng cách sử dụng mẫu SAM.\nChuẩn bị Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nBình luận khối mã này.\n# BookApiDeployment: # Type: AWS::ApiGateway::Deployment # Properties: # RestApiId: !Ref BookApi # DependsOn: # - BookApiGet # - BookApiCreate # - BookApiDelete # - LoginApi # - RegisterApi # - ConfirmApi # - FcjCheckoutOrderApi # - FcjOrderManagementApi # - FcjHandleOrderApi BookApiStage: Type: AWS::ApiGateway::Stage Properties: RestApiId: !Ref BookApi StageName: !Ref stage # DeploymentId: !Ref BookApiDeployment Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Tạo hàm FcjDeleteOrder Mở template.yaml trong mã nguồn bạn đã tải xuống trước đó.\nThêm các đoạn mã sau để tạo hàm FcjDeleteOrder.\nFcjDeleteOrderFunction: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-shop/delete_order Handler: delete_order.lambda_handler Runtime: python3.11 FunctionName: delete_order Environment: Variables: SQS_QUEUE_URL: !Ref checkoutQueueUrl Architectures: - x86_64 Policies: - Statement: - Sid: VisualEditor0 Effect: Allow Action: - sqs:* Resource: - !Sub \u0026#34;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:${checkoutQueueName}\u0026#34; FcjDeleteOrderApi: Type: AWS::ApiGateway::Method Properties: HttpMethod: DELETE RestApiId: !Ref BookApi ResourceId: !Ref FcjCheckoutOrderResource AuthorizationType: NONE Integration: Type: AWS_PROXY IntegrationHttpMethod: POST # For Lambda integrations, you must set the integration method to POST Uri: !Sub \u0026gt;- arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FcjDeleteOrderFunction.Arn}/invocations MethodResponses: - StatusCode: \u0026#34;200\u0026#34; ResponseParameters: method.response.header.Access-Control-Allow-Origin: true method.response.header.Access-Control-Allow-Methods: true method.response.header.Access-Control-Allow-Headers: true FcjDeleteOrderApiInvokePermission: Type: AWS::Lambda::Permission Properties: FunctionName: !Ref FcjDeleteOrderFunction Action: lambda:InvokeFunction Principal: apigateway.amazonaws.com SourceAccount: !Ref \u0026#34;AWS::AccountId\u0026#34; Cấu trúc thư mục như sau.\nfcj-book-shop-sam-ws3 ├── fcj-book-shop │ ├── checkout_order │ │ └── checkout_order.py │ ├── order_management │ │ └── order_management.py │ ├── handle_order │ │ └── handle_order.py │ ├── delete_order │ │ └── delete_order.py │ ├── ... │ └── template.yaml Tạo thư mục delete_order trong thư mục fcj-book-shop-sam-ws6/fcj-book-shop/.\nTạo tệp delete_order.py và sao chép mã sau vào đó.\nimport json import boto3 import os headers = { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Access-Control-Allow-Methods\u0026#34;: \u0026#34;OPTIONS,POST,GET,DELETE\u0026#34;, \u0026#34;Access-Control-Allow-Headers\u0026#34;: \u0026#34;Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token\u0026#34; } sqs = boto3.client(\u0026#39;sqs\u0026#39;) # Get value of the environment variables queue_url = os.getenv(\u0026#39;SQS_QUEUE_URL\u0026#39;) def lambda_handler(event, context): order = json.loads(event[\u0026#39;body\u0026#39;]) try: if \u0026#39;receiptHandle\u0026#39; in order and order[\u0026#39;receiptHandle\u0026#39;]: sqs.delete_message( QueueUrl=queue_url, ReceiptHandle=order[\u0026#39;receiptHandle\u0026#39;] ) else: raise Exception(\u0026#34;No receiptHandle provided\u0026#34;) except Exception as e: print(f\u0026#34;Error deleting order: {e}\u0026#34;) raise Exception(f\u0026#34;Error deleting order: {e}\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;headers\u0026#39;: headers, \u0026#39;body\u0026#39;: json.dumps(\u0026#39;Order deleted successfully\u0026#39;) } Bỏ bình luận khối mã này.\nBookApiDeployment: Type: AWS::ApiGateway::Deployment Properties: RestApiId: !Ref BookApi DependsOn: - BookApiGet - BookApiCreate - BookApiDelete - LoginApi - RegisterApi - ConfirmApi - FcjCheckoutOrderApi - FcjOrderManagementApi - FcjHandleOrderApi - FcjDeleteOrderApi BookApiStage: Type: AWS::ApiGateway::Stage Properties: RestApiId: !Ref BookApi StageName: !Ref stage DeploymentId: !Ref BookApiDeployment Chạy các lệnh dưới đây.\nsam build sam validate sam deploy Kiểm tra việc tạo Mở Amazon API Gateway console.\nNhấp vào fcj-serverless-api. Nhấp vào Resources trên menu bên trái. Kiểm tra /order vừa được tạo. Mở Amazon Lambda console.\nNhấp vào Functions trên menu bên trái. Chọn hàm delete_order. Tại trang delete_order, kiểm tra hàm vừa được tạo. "
},
{
	"uri": "/vi/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/vi/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]